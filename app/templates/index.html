{% extends "base.html" %}

{% block content %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript">
    var protocol = window.location.protocol;
    var socket = io({transports: ['websocket']});
    socket.connect(protocol + '//' + document.domain + ':' + location.port);

    $(document).ready(function() {
    	var negative_width = -$("#hero").width();
		$("#get_started").click(function() {
			$("#start").animate({'margin-left': negative_width, 'margin-right': -negative_width}, 1000, function() {
				$("#start").remove();
				var width = $("#hero").width();
				$("#select").animate({'left': '0vw', 'right': '0vw', 'top': '40%'}, 1000)
			});
		});
	});

    function query_on_type(evt, obj) {
        if (evt.key != 'Enter') {
	        var existing_text = obj.value;
	    	var new_text = existing_text.slice(0, obj.selectionStart) + evt.key + existing_text.slice(obj.selectionEnd, existing_text.length);
	        socket.emit('title request', new_text);
       	} else {
       		socket.emit('query request', {'query_text': obj.value, 'query_type': $("#query_type").val()});
       	}
    }

    function test_for_backspace(evt, obj) {
		var key = (evt.which) ? evt.which : event.keyCode;
		console.log(key)
        if (key == 8 || key == 46) {
        	$("#results").html('');
        }
    }

    socket.on('title result', function(data) {
		$("#results").html(data);
    });

</script>

<section class="hero is-felt is-bold is-large is-fullheight-with-navbar" style="margin-top: 0px;" id="hero">
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.js"></script>
        {% for message in messages %}
            {% if "uccessful" in message or "Welcome" in message %}
              <div class="notification is-success" id="success">
                {{ message }}
            </div>
            {% else %}
            <div class="notification is-danger">
                {{ message }}
            </div>
            {% endif %}
        {% endfor %}
    {% endif %}
    {% endwith %}
	<div class="container" id="parent" style="display: flex; align-items: center;">
		<div class="container" id="start">
			<h1 class="title">
			  Home
			</h1>
			<h2 class="subtitle">
			  	Find movies you'll love with a recommendation system that improves as you use it.<br><b><span style="cursor:pointer" id="get_started">Get started</span></b>
			</h2>
		</div>
	</div>
	<div class="box is-mobile is-centered is-fullwidth" id="select" style="left: 100vw; right: -100vw; top: 40%; overflow: hidden; position: absolute;">
		<div class="column is-centered">
			<h1 class="title has-text-black has-text-centered">What would you like us to use as a reference point?</h1>
			<div class="field has-addons is-fullwidth">
				<div class="control is-expanded">
					<input class="input is-large" type="text" id="query_text" placeholder="Movie title" onkeypress="return query_on_type(event, this)" onkeydown="test_for_backspace(event, this)"></input>
				</div>
                <div class="control">
                    <div class="field is-pulled-right">
                        <div class="control">
                            <div class="select is-large">
                                <select id="query_type">
                                    <option>Movie</option>
                                    <option>Topic</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
			<div class="has-text-centered" id="results"></div>
			<button class="button is-block is-info is-large is-fullwidth">Go!</button>
		</div>
	</div>
</section>

{% endblock %}